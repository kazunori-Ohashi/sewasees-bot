# TDD Discord Bot - プロンプトチューニングガイド

## 🎯 概要

このガイドでは、外部化されたプロンプトファイル（`prompts.yaml`）を使用してTDD Discord Botのプロンプトをチューニングする方法を説明します。

## 📁 ファイル構造

```
prompts.yaml          # メインプロンプト設定ファイル
tdd_bot.py           # Bot本体（プロンプト外部化対応済み）
PROMPT_TUNING_GUIDE.md  # このガイド
```

## 🔧 プロンプト設定ファイル構造

### 基本構造

```yaml
# メタデータ
version: "1.0"
last_updated: "2025-06-29"

# プロンプトセクション
article_generation:    # 記事生成用プロンプト
summarization:         # 要約生成用プロンプト  
markdown_formatting:   # マークダウン整形用プロンプト
tweet_generation:      # ツイート生成用プロンプト
discord_messages:      # Discord通知メッセージ

# 設定情報
metadata:             # API使用情報とチューニングガイド
```

## 📝 プロンプトタイプ別チューニング

### 1. 記事生成プロンプト (`article_generation`)

#### 使用箇所
- **関数**: `generate_article()`
- **コマンド**: `/article`
- **API**: OpenAI GPT-4o-mini
- **パラメータ**: max_tokens=2000, temperature=0.7

#### チューニング可能要素

##### システムプロンプト
```yaml
article_generation:
  system_prompt:
    content: "あなたは専門的なライターです。与えられたコンテンツから、読みやすく構造化された記事を作成してください。"
```

**チューニングポイント:**
- 文体指定（敬語・タメ口・専門用語レベル）
- 専門性の調整（一般向け・専門家向け）
- 記事の長さの傾向

##### PREP法テンプレート
```yaml
prep_template:
  content: |
    以下のコンテンツを、PREP法を使用して魅力的なMarkdown記事に変換してください。
    コンテンツ: {content}
    出力形式:
    # {{{{POINT}}}}
    問題を明確に提示してください
    ## {{{{REASON}}}}
    問題の深刻さや影響を説明してください
    ## {{{{EXAMPLE}}}}
    解決策や提案を具体的に示してください  
    ## {{{{POINT}}}} (まとめ)
    解決策の価値を再強調してください
```

**チューニングポイント:**
- セクション見出しの調整
- 各セクションの詳細度指定
- Markdown要素の使用方針（表・リスト・コードブロック等）

##### PAS法テンプレート
```yaml
pas_template:
  content: |
    以下のコンテンツを、PAS法を使用して説得力のあるMarkdown記事に変換してください。
    コンテンツ: {content}
    出力形式:
    # {{{{PROBLEM}}}}
    問題・課題を明確に提示してください
    ## {{{{AGITATION}}}}  
    問題の深刻さや緊急性を強調してください
    ## {{{{SOLUTION}}}}
    具体的な解決策を提示してください
    ## 結論
    解決策の効果と価値をまとめてください
```

**チューニングポイント:**
- 感情的訴求の強さ調整
- 緊急性の表現レベル
- 解決策の具体性

### 2. 要約生成プロンプト (`summarization`)

#### 使用箇所
- **関数**: `generate_tldr()`
- **コマンド**: `/tldr`, `/article`（include_tldr=True時）
- **API**: OpenAI GPT-4o-mini
- **パラメータ**: max_tokens=300, temperature=0.3

#### チューニング可能要素

##### システムプロンプト
```yaml
system_prompt:
  content: "あなたは要約のエキスパートです。長文を短く分かりやすい要点にまとめることに特化しています。"
```

##### TLDR生成テンプレート
```yaml
tldr_template:
  content: |
    以下のコンテンツを読みやすい要約（TLDR形式）にしてください。
    
    要求事項：
    - 3〜5つの要点を箇条書きで
    - 各ポイントは絵文字付きで分かりやすく
    - 全体で200文字以内
    - 読者がすぐに理解できる簡潔さ
    
    コンテンツ: {content}
    
    出力形式:
    🔹 [要点1]
    🔹 [要点2]
    🔹 [要点3]
```

**チューニングポイント:**
- 要点数の調整（3-5個）
- 文字数制限の変更（200文字基準）
- 絵文字の種類や使用方針
- 要約の詳細度レベル

### 3. マークダウン整形プロンプト (`markdown_formatting`)

#### 使用箇所
- **関数**: `on_message()` のInsert処理
- **コマンド**: `/insert`
- **API**: OpenAI GPT-4o-mini
- **パラメータ**: max_tokens=1200, temperature=0.5

#### チューニング可能要素

```yaml
formatting_template:
  content: |
    以下のテキストを適切なMarkdown形式に整形してください。見出し、リスト、強調などを適切に使用して読みやすくしてください。
    
    元のテキスト: {content}
    
    整形のガイドライン:
    - 適切な見出しレベル（#, ##, ###）を使用
    - リストや箇条書きを活用
    - 重要な部分は**太字**や*斜体*で強調
    - 必要に応じてコードブロックや引用を使用
    - 読みやすい構造と適切な改行を心がける
    
    整形されたMarkdown:
```

**チューニングポイント:**
- 見出しレベルの使い分け基準
- 強調表現の使用頻度
- リストの構造化レベル
- コードブロックの判断基準

### 4. ツイート生成プロンプト (`tweet_generation`)

#### 使用箇所
- **関数**: `on_message()` の❤️リアクション処理
- **イベント**: メッセージに❤️リアクション追加時
- **API**: OpenAI GPT-4o-mini
- **パラメータ**: max_tokens=160, temperature=0.7

#### チューニング可能要素

```yaml
tweet_template:
  content: "以下の内容を140文字以内で魅力的なツイートにしてください。適切な絵文字を使っても構いません。\n\n{content}"
```

**チューニングポイント:**
- 文字数制限の調整（140文字基準）
- 絵文字使用の方針
- 魅力的表現のレベル
- ハッシュタグ使用の有無

## 🎛️ パラメータチューニング

### Temperature設定指針

| 用途 | 推奨範囲 | 現在値 | 説明 |
|------|---------|-------|------|
| 記事生成 | 0.7-0.9 | 0.7 | 創造性重視 |
| TLDR要約 | 0.3-0.5 | 0.3 | 一貫性重視 |
| Markdown整形 | 0.1-0.3 | 0.5 | 構造化重視 |
| ツイート生成 | 0.7-0.9 | 0.7 | 魅力性重視 |

### Max Tokens設定指針

| 用途 | 推奨範囲 | 現在値 | 説明 |
|------|---------|-------|------|
| 記事生成 | 1500-2500 | 2000 | 長文記事対応 |
| TLDR要約 | 200-400 | 300 | 簡潔な要約 |
| Markdown整形 | 800-1500 | 1200 | 中程度整形 |
| ツイート生成 | 100-200 | 160 | 短文生成 |

## 🔄 プロンプトの更新手順

### 1. バックアップ作成
```bash
cp prompts.yaml prompts_backup_$(date +%Y%m%d_%H%M%S).yaml
```

### 2. プロンプト編集
`prompts.yaml`ファイルを直接編集

### 3. 構文チェック
```bash
python3 -c "import yaml; yaml.safe_load(open('prompts.yaml'))"
```

### 4. Bot再起動
プロンプトキャッシュをクリアするためBot再起動

### 5. テスト実行
各機能の動作確認

## 📊 効果測定

### 測定項目
1. **記事品質**: 構造・読みやすさ・内容の充実度
2. **要約精度**: 要点の抽出・文字数・理解しやすさ
3. **整形品質**: Markdown構文・視認性・構造化度
4. **ツイート魅力度**: 文字数・インパクト・拡散性

### A/Bテスト手法
1. 元プロンプトと新プロンプトで同一コンテンツを処理
2. 出力結果を比較評価
3. ユーザーフィードバックを収集
4. 客観的指標で効果測定

## 🚨 注意事項

### 必須ルール
1. **アルゴリズム保持**: `tdd_bot.py`のロジック部分は絶対に変更しない
2. **YAML構文**: 正しいYAML記法を維持
3. **変数名保持**: `{content}`等の変数名は変更しない
4. **キー名保持**: セクション・キー名は既存のものを維持

### ベストプラクティス
1. **段階的変更**: 大幅な変更は避け、少しずつ調整
2. **記録保持**: 変更内容と効果を記録
3. **ロールバック準備**: 問題時は即座に元に戻せるよう準備
4. **ユーザー影響**: エンドユーザーへの影響を考慮

## 📈 高度なチューニングテクニック

### 1. コンテキスト適応型プロンプト
異なるファイル形式や内容タイプに応じてプロンプトを調整

### 2. 動的パラメータ調整
コンテンツ長に応じてmax_tokensを動的に調整

### 3. 多段階プロンプト
複雑なタスクを複数ステップに分解

### 4. プロンプトチェイン
複数のプロンプトを連鎖させて高品質な出力を実現

## 📚 参考情報

### プロンプトエンジニアリング原則
1. **明確性**: 曖昧さを排除した明確な指示
2. **具体性**: 具体的な例や形式の提示
3. **一貫性**: 同一目的では一貫したトーン
4. **最適化**: 不要な要素の削除

### OpenAI API仕様
- [OpenAI Documentation](https://platform.openai.com/docs)
- [Best Practices for Prompt Engineering](https://help.openai.com/en/articles/6654000-best-practices-for-prompt-engineering-with-openai-api)

---

*このガイドはTDD Discord Bot v2.0のプロンプト外部化機能に基づいて作成されています。*